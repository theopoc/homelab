# TEMPLATE - Do not edit directly
#
# Usage:
#   1. Configure .env (see .env.example)
#   2. task argocd:generate-secrets
#
# This generates secrets.sops.yaml with random passwords and encrypts it.
# Only AWS credentials and AGE key are read from .env.
#
# POST-BOOTSTRAP: After Keycloak creates the realm, get the client secrets
# from Keycloak admin console and update grafana-oauth and argocd-secret.
---
# Route53 credentials for cert-manager DNS01 challenge
apiVersion: v1
kind: Secret
metadata:
  name: route53-credentials
  namespace: cert-manager
type: Opaque
stringData:
  access-key-id: REPLACE_ME
  secret-access-key: REPLACE_ME
  hosted-zone-id: REPLACE_ME
---
# Keycloak database credentials
apiVersion: v1
kind: Secret
metadata:
  name: keycloak-secrets
  namespace: keycloak
type: Opaque
stringData:
  db-username: keycloak
  db-password: REPLACE_ME
---
# PostgreSQL credentials (must match keycloak db-password)
apiVersion: v1
kind: Secret
metadata:
  name: postgres-credentials
  namespace: postgres
type: kubernetes.io/basic-auth
stringData:
  username: keycloak
  password: REPLACE_ME
---
# Grafana admin credentials
apiVersion: v1
kind: Secret
metadata:
  name: grafana-admin
  namespace: monitoring
type: Opaque
stringData:
  admin-user: admin
  admin-password: REPLACE_ME
---
# Grafana OAuth client secret (injected as env var)
# POST-BOOTSTRAP: Update with secret from Keycloak > homelab realm > grafana client
apiVersion: v1
kind: Secret
metadata:
  name: grafana-oauth
  namespace: monitoring
type: Opaque
stringData:
  GF_AUTH_GENERIC_OAUTH_CLIENT_SECRET: REPLACE_WITH_KEYCLOAK_SECRET
---
# ArgoCD secret (replaces Helm-generated argocd-secret)
# POST-BOOTSTRAP: Update oidc.keycloak.clientSecret with secret from Keycloak > homelab realm > argocd client
apiVersion: v1
kind: Secret
metadata:
  name: argocd-secret
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-secret
    app.kubernetes.io/part-of: argocd
type: Opaque
stringData:
  # OIDC client secret for Keycloak (referenced as $oidc.keycloak.clientSecret in OIDC config)
  oidc.keycloak.clientSecret: REPLACE_WITH_KEYCLOAK_SECRET
---
# SOPS AGE key for ArgoCD repo-server decryption
apiVersion: v1
kind: Secret
metadata:
  name: sops-age-key
  namespace: argocd
type: Opaque
stringData:
  keys.txt: |
    # AGE-SECRET-KEY-REPLACE_ME
