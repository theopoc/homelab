apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Generate ConfigMap from external JS file for better maintainability
configMapGenerator:
  - name: n8n-hooks
    namespace: n8n
    files:
      - hooks.js=resources/n8n/hooks.js
    options:
      disableNameSuffixHash: true

resources:
  # Projects (for multi-tenancy)
  - projects/landing-project.yaml
  # Apps
  - apps/root-app.yaml
  - apps/infrastructure/argocd.yaml
  - apps/infrastructure/argocd-route.yaml
  - apps/infrastructure/cilium-gateway.yaml
  - apps/infrastructure/cloudnative-pg.yaml
  - apps/infrastructure/postgres-cluster.yaml
  - apps/infrastructure/reloader.yaml
  - apps/infrastructure/argocd-image-updater.yaml
  # n8n apps
  - apps/n8n/oauth2-proxy.yaml
  # Uptime Kuma
  # Landing page
  - apps/landing/landing.yaml
  # Playwright MCP server
  # n8n MCP server
  # Resources (only those NOT managed by child apps)
  - resources/cert-manager/cluster-issuer.yaml
  # Keycloak via operator CRDs (no child app for these)
  # Monitoring resources
  # n8n resources (namespace, jobs, routes)
  # Note: n8n-hooks ConfigMap is generated via configMapGenerator from hooks.js
  # Uptime Kuma resources
  # All secrets are in overlay secrets.sops.yaml
  # NOTE: gateway, postgres/cluster, and routes are managed by child apps
